<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />

    <!-- NeuroPACS SDK -->
    <script src="https://neuropacs.com/js/src/neuropacs.min.js"></script>

    <title>NeuroPACS SDK Example</title>
  </head>
  <body>
    <script>
      async function main() {
        const apiKey = "m0ig54amrl87awtwlizcuji2bxacjm";
        const serverUrl = "http://localhost:5000";
        const productId = "PD/MSA/PSP-v1.0";
        const format = "XML";

        try {
          // INITIALIZE NEUROPACS SDK
          const npcs = new Neuropacs(apiKey, serverUrl);

          // GENERATE AN AES KEY
          const aesKey = npcs.generateAesKey();

          // CONNECT TO NEUROPACS
          const connectionID = await npcs.connect(apiKey, aesKey);

          // CREATE A NEW JOB
          const orderID = await npcs.newJob(connectionID, aesKey);

          // UPLOAD A FILE/DATASET
          const blobData1 = new Blob(["Hello, world!"], { type: "text/plain" });
          const file1 = new File([blobData1], "example1.txt", {
            type: "text/plain"
          });
          const blobData2 = new Blob(["Hello, world!"], { type: "text/plain" });
          const file2 = new File([blobData2], "example2.txt", {
            type: "text/plain"
          });
          const blobData3 = new Blob(["Hello, world!"], { type: "text/plain" });
          const file3 = new File([blobData3], "example3.txt", {
            type: "text/plain"
          });
          const dataset = [file1, file2, file3];
          const uploadStatus = await npcs.uploadDataset(
            dataset,
            orderID,
            connectionID,
            aesKey
          );

          //START A JOB
          const job = await npcs.runJob(
            productId,
            orderID,
            connectionID,
            aesKey
          );

          // CHECK STATUS
          const status = await npcs.checkStatus(orderID, connectionID, aesKey);

          // GET RESULTS
          const results = await npcs.getResults(
            format,
            orderID,
            connectionID,
            aesKey
          );
        } catch (e) {
          console.log(e);
        }
      }

      main();
    </script>
  </body>
</html>
